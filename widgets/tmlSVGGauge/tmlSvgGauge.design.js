function newDtSvgGauge(widgetLabel) {
  var DEFAULT_TEXT = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\
	 viewBox="0 0 300 300" style="enable-background:new 0 0 300 300;" xml:space="preserve">\
<style type="text/css">\
	.st0{fill:#FFFFFF;}\
	.st1{filter:url(#Adobe_OpacityMaskFilter);}\
	.st2{opacity:3.000000e-02;mask:url(#SVGID_1_);}\
	.st3{fill:#6FBF4C;}\
	.st4{fill:#546F7A;}\
	.st5{fill:#455B64;}\
	.st6{font-family:sans-serif;}\
	.st7{font-size:18px;}\
	.st8{fill-rule:evenodd;clip-rule:evenodd;fill:#2B6733;}\
	.st9{opacity:0.6;fill:url(#SVGID_2_);}\
	.st10{fill:#E2532A;}\
	.st11{fill:#CE4127;}\
	.st12{fill:#55707F;}\
	.st13{font-size:22px;}\
	.st14{fill:{{me.textColor}}}\
	.st15{font-size:48px;}\
</style>\
<g>\
	<g>\
		<g>\
			<path class="st0" d="M150,8C112.1,8,76.4,22.8,49.6,49.6C22.8,76.4,8,112.1,8,150s14.8,73.6,41.6,100.4\
				C76.4,277.2,112.1,292,150,292s73.6-14.8,100.4-41.6C277.2,223.6,292,187.9,292,150s-14.8-73.6-41.6-100.4\
				C223.6,22.8,187.9,8,150,8z"/>\
		</g>\
		<defs>\
			<filter id="Adobe_OpacityMaskFilter" filterUnits="userSpaceOnUse" x="8" y="8" width="284" height="284">\
					<feColorMatrix  type="matrix" values="-1 0 0 0 1  0 -1 0 0 1  0 0 -1 0 1  0 0 0 1 0" color-interpolation-filters="sRGB" result="source"/>\
			</filter>\
		</defs>\
		<mask maskUnits="userSpaceOnUse" x="8" y="8" width="284" height="284" id="SVGID_1_">\
			<g class="st1">\
			</g>\
		</mask>\
		<g class="st2">\
			<path d="M150,8C112.1,8,76.4,22.8,49.6,49.6C22.8,76.4,8,112.1,8,150s14.8,73.6,41.6,100.4C76.4,277.2,112.1,292,150,292\
				s73.6-14.8,100.4-41.6C277.2,223.6,292,187.9,292,150s-14.8-73.6-41.6-100.4C223.6,22.8,187.9,8,150,8z"/>\
		</g>\
	</g>\
	<path class="st3" d="M205,289.6c-2.3,0.9-4.6,1.7-6.9,2.5C200.4,291.3,202.7,290.5,205,289.6z"/>\
	<path class="st3" d="M265.7,245.4c-1.5,1.9-3.1,3.7-4.7,5.4C262.6,249.1,264.2,247.3,265.7,245.4z"/>\
	<path class="st3" d="M272.3,236.8c-2.1,2.9-4.3,5.8-6.6,8.6C268,242.6,270.2,239.8,272.3,236.8z"/>\
	<path class="st3" d="M194.6,293.3c-2.3,0.7-4.7,1.4-7.1,2C189.9,294.7,192.3,294,194.6,293.3z"/>\
	<path class="st3" d="M295.3,187.5c-0.6,2.4-1.3,4.8-2,7.1C294,192.3,294.7,189.9,295.3,187.5z"/>\
	<path class="st3" d="M278.3,227.8c-1.3,2.1-2.6,4.1-3.9,6.1C275.7,231.9,277,229.8,278.3,227.8z"/>\
	<path class="st3" d="M297,180.2c-0.5,2.4-1.1,4.9-1.7,7.3C295.9,185.1,296.5,182.7,297,180.2z"/>\
	<path class="st3" d="M292.1,198.1c-0.8,2.3-1.6,4.6-2.5,6.9C290.5,202.7,291.3,200.4,292.1,198.1z"/>\
	<path class="st3" d="M288.2,208.4c-2.8,6.7-6.2,13.2-9.9,19.4C282,221.6,285.4,215.1,288.2,208.4z"/>\
	<path class="st3" d="M112.5,295.3c-2.4-0.6-4.8-1.3-7.1-2C107.7,294,110.1,294.7,112.5,295.3z"/>\
	<path class="st3" d="M21.7,227.8c-3.8-6.2-7.1-12.7-9.9-19.4C14.6,215.1,18,221.6,21.7,227.8z"/>\
	<path class="st3" d="M10.4,205c-0.9-2.3-1.7-4.6-2.5-6.9C8.7,200.4,9.5,202.7,10.4,205z"/>\
	<path class="st3" d="M6.7,194.6c-0.7-2.3-1.4-4.7-2-7.1C5.3,189.9,6,192.3,6.7,194.6z"/>\
	<path class="st3" d="M4.7,187.5c-0.6-2.4-1.2-4.8-1.7-7.3C3.5,182.7,4.1,185.1,4.7,187.5z"/>\
	<path class="st3" d="M34.3,245.4c-2.3-2.8-4.5-5.6-6.6-8.6C29.8,239.8,32,242.6,34.3,245.4z"/>\
	<path class="st3" d="M25.6,233.9c-1.3-2-2.6-4-3.9-6.1C23,229.8,24.3,231.9,25.6,233.9z"/>\
	<path class="st3" d="M39,250.9c-1.6-1.8-3.2-3.6-4.7-5.4C35.8,247.3,37.4,249.1,39,250.9z"/>\
	<path class="st3" d="M101.9,292.1c-2.3-0.8-4.6-1.6-6.9-2.5C97.3,290.5,99.6,291.3,101.9,292.1z"/>\
	<path class="st4" d="M150,0C67.2,0,0,67.2,0,150c0,10.4,1,20.5,3,30.2c0.5,2.4,1.1,4.9,1.7,7.3c0.6,2.4,1.3,4.8,2,7.1\
		c0.4,1.2,0.7,2.3,1.1,3.5c0.8,2.3,1.6,4.6,2.5,6.9c0.4,1.1,0.9,2.3,1.4,3.4c2.8,6.7,6.2,13.2,9.9,19.4c1.3,2.1,2.6,4.1,3.9,6.1\
		c0.7,1,1.4,2,2.1,3c2.1,2.9,4.3,5.8,6.6,8.6c1.5,1.9,3.1,3.7,4.7,5.4c15.3,16.9,34.5,30.2,56,38.7c2.3,0.9,4.6,1.7,6.9,2.5\
		c1.2,0.4,2.3,0.8,3.5,1.1c2.3,0.7,4.7,1.4,7.1,2c12,3.1,24.5,4.7,37.5,4.7s25.5-1.6,37.5-4.7c2.4-0.6,4.8-1.3,7.1-2\
		c1.2-0.4,2.3-0.7,3.5-1.1c2.3-0.8,4.6-1.6,6.9-2.5c21.6-8.5,40.7-21.9,56-38.7c1.6-1.8,3.2-3.6,4.7-5.4c2.3-2.8,4.5-5.6,6.6-8.6\
		c0.7-1,1.4-2,2.1-3c1.3-2,2.6-4,3.9-6.1c3.8-6.2,7.1-12.7,9.9-19.4c0.5-1.1,0.9-2.3,1.4-3.4c0.9-2.3,1.7-4.6,2.5-6.9\
		c0.4-1.2,0.8-2.3,1.1-3.5c0.7-2.3,1.4-4.7,2-7.1c0.6-2.4,1.2-4.8,1.7-7.3c2-9.8,3-19.9,3-30.2C300,67.2,232.8,0,150,0z\
		 M250.4,250.4C223.6,277.2,187.9,292,150,292s-73.6-14.8-100.4-41.6C22.8,223.6,8,187.9,8,150S22.8,76.4,49.6,49.6\
		C76.4,22.8,112.1,8,150,8s73.6,14.8,100.4,41.6C277.2,76.4,292,112.1,292,150S277.2,223.6,250.4,250.4z"/>\
</g>\
<text transform="matrix(1 0 0 1 226.2693 155.3672)" class="st5 st6 st7">{{me.maxValue}}</text>\
<text transform="matrix(1 0 0 1 43.9063 155.3672)" class="st5 st6 st7">{{me.minValue}}</text>\
<g>\
	<g>\
		<path class="st8" d="M30.7,136.3l-16.9-1.8l-0.2,2l16.9,1.8L30.7,136.3z M32.8,124l-16.6-3.5l-0.4,2l16.6,3.5L32.8,124z\
			 M36.1,111.9l-16.2-5.2l-0.6,1.9l16.2,5.2L36.1,111.9z M24.4,95.1l15.5,6.9l0.8-1.8l-15.5-6.9L24.4,95.1z M53.4,78.6l-13.8-10\
			l-1.2,1.6l13.8,10L53.4,78.6z M47.3,59L60,70.4l1.3-1.5L48.7,57.5L47.3,59z M57.4,48.8l11.4,12.6l1.5-1.3L58.9,47.5L57.4,48.8z\
			 M68.4,39.7l10,13.7l1.6-1.2L70,38.5L68.4,39.7z M93,25.2l6.9,15.5l1.8-0.8l-6.9-15.5L93,25.2z M106.4,19.9l5.3,16.2l1.9-0.6\
			l-5.3-16.2L106.4,19.9z M120.2,16.1l3.6,16.6l2-0.4l-3.6-16.6L120.2,16.1z M134.3,13.7l1.8,16.9l2-0.2l-1.8-16.9L134.3,13.7z\
			 M161.1,30.3l2,0.2l1.7-16.9l-2-0.2L161.1,30.3z M173.5,32.1l2,0.4l3.5-16.6l-2-0.4L173.5,32.1z M185.7,35.2l1.9,0.6l5.2-16.2\
			l-1.9-0.6L185.7,35.2z M204.3,24l-6.9,15.6l1.8,0.8l6.9-15.6L204.3,24z M229.2,38l-9.9,13.8l1.6,1.2l9.9-13.8L229.2,38z\
			 M240.5,46.9l-11.3,12.7l1.5,1.3L242,48.2L240.5,46.9z M250.7,56.9l-12.6,11.4l1.3,1.5l12.6-11.4L250.7,56.9z M247.3,79.6\
			L261,69.5l-1.2-1.6L246.2,78L247.3,79.6z M274.5,92.5l-15.5,7l0.8,1.8l15.5-7L274.5,92.5z M264.3,113l16.1-5.3l-0.6-1.9l-16.1,5.3\
			L264.3,113z M267.5,125.2l16.6-3.6l-0.4-2l-16.6,3.6L267.5,125.2z M269.4,137.5l16.9-1.9l-0.2-2l-16.9,1.9L269.4,137.5z M147,12.8\
			l0,26h6l0-26H147z M267.1,78.7l-22.5,13c1,1.7,2.1,3.4,3,5.2l22.5-13L267.1,78.7z M78.8,32.7l13,22.6c1.7-1,3.4-2.1,5.2-3L84,29.7\
			L78.8,32.7z M261,146.8v6l26,0v-6L261,146.8z M215.8,29.7l-13,22.5c1.8,1,3.5,2,5.2,3l13-22.5L215.8,29.7z M13,152.8h26v-6H13\
			V152.8z M29.8,83.9l22.5,13c1-1.8,2-3.5,3-5.2l-22.6-13L29.8,83.9z"/>\
	</g>\
</g>\
<radialGradient id="SVGID_2_" cx="150" cy="150.0036" r="20" gradientUnits="userSpaceOnUse">\
	<stop  offset="0" style="stop-color:#FFFFFF"/>\
	<stop  offset="1" style="stop-color:#C9C9C9"/>\
</radialGradient>\
<circle class="st9" cx="150" cy="150" r="20"/>\
<g transform="rotate({{( (me.value - me.minValue) * 180 / (me.maxValue - me.minValue) - 90) + \', 150, 150)\'}}">\
	<path class="st10" d="M152.3,51.9c-0.2-1.3-1-2.3-2.3-2.3s-2.2,1-2.3,2.3l-7,101.4c0,0,0,0,0,0l7-101.4c0.1-1.3,1-2.3,2.3-2.3\
		v106.1c1.3,0,9.3-1,9.3-2.3L152.3,51.9z"/>\
	<path class="st11" d="M140.7,153.3L140.7,153.3c0,1.3,8,2.3,9.3,2.3v0C148.7,155.7,140.7,154.6,140.7,153.3z"/>\
	<path class="st11" d="M147.7,51.9l-7,101.4c0,1.3,8,2.3,9.3,2.3V49.6C148.7,49.6,147.8,50.6,147.7,51.9z"/>\
</g>\
<g>\
	<g>\
		<circle class="st0" cx="150" cy="150.1" r="12.5"/>\
	</g>\
</g>\
<text text-anchor="middle" x="50%" y="209" class="st12 st6 st13">{{me.label + me.unit}}</text>\
<text text-anchor="middle" x="50%" y="251" class="st14 st6 st15">{{me.value}}</text>\
</svg>';
  var properties = [{
    name: 'src',
    label: 'Resource',
    datatype: 'resource_url',
    resource_image: true,
    default: 'Default/vu_gauge1.svg',
    isBindingTarget: true,
    alwaysWriteAttribute: true,
    sortOrder: 2
  }, {
    name: 'label',
    label: 'Label',
    datatype: 'string',
    isBindingTarget: true,
    default: ''
  }, {
    name: 'value',
    label: 'Value',
    datatype: 'number',
    isBindingTarget: true,
    default: '100'
  }, {
    name: 'minValue',
    label: 'Min Value',
    isBindingTarget: true,
    datatype: 'number',
    default: '0'
  },
  {
    name: 'maxValue',
    label: 'Max Value',
    isBindingTarget: true,
    datatype: 'number',
    default: '100'
  },
  {
    name: 'unit',
    label: 'Unit',
    isBindingTarget: true,
    datatype: 'string',
    default: '%'
  },
  {
    name: 'textColor',
    label: 'textColor',
    isBindingTarget: true,
    datatype: 'string',
    default: '#125E3D'
  },

  {
    name: 'text',
    label: 'Text',
    default: DEFAULT_TEXT,
    datatype: 'string',
    isVisible: false,
    value: DEFAULT_TEXT
  }, {
    name: 'textEditor',
    label: 'Text',
    datatype: 'custom_ui',
    buttonLabel: 'Edit Text',
    title: 'Edit Text',
    template: function (widgetProps) {
      return '<textarea ng-model="props.text.value" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 300, \'blur\': 0 } }"  rows="10" cols="80"></textarea>';
    },
    sortOrder: 1
  }, {
    name: 'canvasgrowthoverride',
    label: 'Canvas Growth Override',
    datatype: 'string',
    default: 'image+text',
    isBindingTarget: true,
    editor: 'select',
    options: [{
      label: 'Canvas grows with text size',
      value: 'text'
    }, {
      label: 'Canvas grows with image Size',
      value: 'image'
    }, {
      label: 'Canvas grows with image and text sizes',
      value: 'image+text'
    }, {
      label: 'No Override',
      value: 'canvas'
    }],
    sortOrder: 122
  }, {
    name: 'canvasheight',
    label: 'Canvas Height',
    datatype: 'number',
    default: 600,
    isBindingTarget: false,
    alwaysWriteAttribute: true,
    sortOrder: 123
  }, {
    name: 'canvaswidth',
    label: 'Canvas Width',
    datatype: 'number',
    default: 600,
    isBindingTarget: false,
    alwaysWriteAttribute: true,
    sortOrder: 124
  }, {
    name: 'billboard',
    label: 'Billboard',
    datatype: 'boolean',
    default: true,
    isBindingTarget: true,
    alwaysWriteAttribute: true,
    sortOrder: 200
  }
  ];

  properties.push(Twx3dCommon.getPivotProperty());
  properties.push(Twx3dCommon.getWidthProperty());
  properties.push(Twx3dCommon.getHeightProperty());

  var overlay = Twx3dCommon.arrayToMap(properties);

  var props = Twx3dCommon.new3dProps(overlay);

  var retObj = {
    elementTag: "tml-svg-gauge",

    isVisibleInPalette: true,

    supports3D: true,

    label: widgetLabel,
    category: 'ar',
    groups: ['SVG Augmentations'],

    isContainer: false,

    properties: props,

    isBuildRequired: function (changedProps) {
      if (changedProps === undefined) {
        return false;
      }
      var changedPropKeys = Object.keys(changedProps);

      if (changedPropKeys.length == 0) {
        return false;
      }

      for (var i = 0; i < changedPropKeys.length; i++) {
        var currentKey = changedPropKeys[i];
        //if any of the changed props show up in overlay return true
        if (overlay[currentKey] !== undefined) {
          return true;
        }
      }
    },

    designTemplate: function (props) {
      return ('<!-- 3dSensor -->');
    },

    runtimeTemplate: function (props) {
      // no longer builds textattrs or imageattrs live here
      var tmpl = '<twx-dt-svg ' +
        'id="' + props.widgetId + '" ' +
        'x="{{me.x}}" ' +
        'y="{{me.y}}" ' +
        'z="{{me.z}}" ' +
        'rx="{{me.rx}}" ' +
        'ry="{{me.ry}}" ' +
        'rz="{{me.rz}}" ' +
        'sx="{{me.scale.split(\' \')[0] || me.scale}}" ' +
        'sy="{{me.scale.split(\' \')[1] || me.scale}}" ' +
        'sz="{{me.scale.split(\' \')[2] || me.scale}}" ' +
        'billboard="{{me.billboard}}" ' +
        'occlude="{{me.occlude}}" ' +
        'opacity="{{me.opacity}}" ' +
        'decal="{{me.decal}}" ' +
        'canvasheight="{{me.canvasheight}}" ' +
        'canvaswidth="{{me.canvaswidth}}" ' +
        'height="{{me.height}}" ' +
        'width="{{me.width}}" ' +
        'canvasgrowthoverride="{{me.canvasgrowthoverride}}" ' +
        'textx="{{me.textx}}" ' +
        'texty="{{me.texty}}" ' +
        'imagex="{{me.imagex}}" ' +
        'imagey="{{me.imagey}}" ' +
        'shader="{{me.shader}}" ' +
        //'visible="{{me.visible}}" ' +
        'hidden="{{!me.visible}}">' + props.text + "</twx-dt-svg>";
      //'hidden="{{ (me.visible === \'true\' || me.visible === true) ? false : true}}"/>';
      //console.log("twxArSensor.runtimeTemplate: " + tmpl);
      return tmpl;
    },

    events: [
      {
        name: 'click',
        label: 'ves-ar-extension:Click'
      }
    ]
  };
  return retObj;
}

function twxDtSvgGauge() {
  return Twx3dCommon.getWidget('Gauge 3D SVG', newDtSvgGauge);
}

twxAppBuilder.widget('tml-svg-gauge', twxDtSvgGauge);